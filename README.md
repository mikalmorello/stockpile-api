
# Stockpile

The stockpile app will allow users to create different groups of stocks, compare their performance, and share their stock picks with friends.  The app will help users refine their investment strategies by seeing which stock groups perform better, while also adding a social element of being able to share and see their friends stock picks.

![Stockpile Screenshot](stockpile_screenshot.png)




## Tech Stack

**Client:** [React](https://reactjs.org/docs/create-a-new-react-app.html), [SASS](https://sass-lang.com/), [CSS Modules](https://create-react-app.dev/docs/adding-a-css-modules-stylesheet/)

**Server / API:** [Python](https://www.python.org/), [Django](https://www.djangoproject.com/), [Django REST Framework](https://www.django-rest-framework.org/)

**Database:** [SQLite](https://www.sqlite.org/index.html)

**Authentication:** [JSON Web Token Authentication (SimpleJWT)](https://django-rest-framework-simplejwt.readthedocs.io/en/latest/)


## Overview

The project contains two repos, a client side application and a backend API.  

### Client
**Path to Repo:** /stockpile

The client side application was developed using Create-React-App.  The front end styling is handled through SASS using CSS Modules. Routing is handled using React Router.

### Server / API
**Path to Repo:** /stockpile_api

The back-end application is developed using Django / Python, utilizing the Django REST Framework.  The backend works primarily as an API for the client side application, providing authentication, user management, external API calls, and data management.

### Authentication
In order to setup user authentication between the Django REST Framework and the client side React website, the [JSON Web Token Authentication (SimpleJWT)](https://django-rest-framework-simplejwt.readthedocs.io/en/latest/) was utilized.  Django creates two tokens for users, access and refresh.  Tokens are refreshed on a regular basis for security purposes.  Authentication is required to login to the application, but also to access certain API endpoints.

#### Tutorial
The following [Dennis Ivy YouTube tutorial](https://www.youtube.com/watch?v=xjMP0hspNLE) provided the base steps for implementing web tokens from Django to React.  Please note that changes are required when using the updated React Router V6.

### Stock data
In order to pull down stock data, two resources were ultilized:

#### AlphaVantage
[AlphaVantage](https://www.alphavantage.co/) provides the daily stock updates that get pulled into the application on demand. Currently only the endpoint used is the ["TIME_SERIES_DAILY"](https://www.alphavantage.co/documentation/#daily).  There are rate limits and restrictions if using the base free tier.  The application tried to take this into account.

#### NASDAQ
Stock symbols are updated on a regular basis. A list of stock symbols is available on the [NASDAQ Trader website](http://www.nasdaqtrader.com/trader.aspx?id=symboldirdefs) in a .txt download.
## Installation

Since the front-end application and the back-end API are decoupled, you will need to run the following install commands for each repo seperatly:

Navigate to the base "stockpile" directory
```bash
# Navigate to the base project directory
cd stockpile
```

### Server / API
#### Install the project requirements from the requirements.txt file
```bash
pip3 install django-cors-headers --user
pip3 install requests --user
pip3 install djangorestframework --user
pip3 install djangorestframework-simplejwt --user
pip3 install python-decouple --user
```

#### Start the Django Project.  
*Please note that your commands may differ slightly based upon how your Python version is installed (python vs python3, pip vs pip3) etc.*
```bash
# Navigate to the Django project
cd stockpile_api
# Start the server
python3 manage.py runserver
```

#### Make migrations
Make the following database migrations:
```bash
python3 manage.py migrate
```

#### Create a superuser (follow prompts)
```bash
python3 manage.py createsuperuser
```

#### Environment Variables
**IMPORTANT** Make sure you set up the environment variables outlined below for both the client and the backend.

#### Access the application
You should now be able to access the application:

API **http://127.0.0.1:8000/api/{endpoint}**

ADMIN **http://127.0.0.1:8000/admin**

In order to pull in stock symbols, you will want to navigate to:

ADMIN **http://127.0.0.1:8000/symbols/update**

### Client Side
#### Start the Create React App project

```bash
# Navigate to the React App directory
cd stockpile
# Install NPM dependencies
npm install
# Start project
npm start
```


#### Access the application
http://localhost:3000/ (login with user credentials)

*If you are having access issues, check to make sure tokens were generated by Django for the corresponding user.*
Sometimes the application will need to be refreshed if tokens aren't working...

    
## Environment Variables

To run this project, you will need to add the following environment variables:

### Client Side
The client side currently uses one environment variable which will change depending upon the environment, DEV or PROD:

**`REACT_APP_STOCKPILE_API_URL`** 

**.env.development.local** the value is "//127.0.0.1:8000"
**.env.production.local** the value is "//thestockpile.app" (eventual domain)

### Server / API
The server uses an external API to pull stock data from [AlphaVantage](https://www.alphavantage.co/).  You can grab a [free API key](https://www.alphavantage.co/support/#api-key) and add it to the following variable. 
**`ALPHAVANTAGE_API_KEY=`** 

**.env** 

## Models
The stockpile applications makes use of the following model types

### User
#### class **User**
"id", "username", "email"

*Includes general user data*

### Stockpile
#### class **Stockpile**
"title", "stocks", "date_created", "creator"

*Includes data about stockpiles which are collections of selected stocks created by users*

### Symbol
#### class **Symbol**
"symbol", "name", "date_created"

*A list of available stock symbols for the user to select for their stockpiles*

### Stock
#### class **Stock**
"symbol", "last_refreshed", "daily", "day_change", "week_change"

*A list of all stocks selected or viewed by users (used for reducing external API calls when updating stock data)*
## API Reference


### Stockpiles

#### Get all stockpiles

```http
  GET /api/stockpiles
```

| Notes               |
| :------------------------- |
| **Required**. Token authentication |

#### Get all user stockpiles

```http
  GET /api/stockpiles/user
```

| Notes               |
| :------------------------- |
| **Required**. Token authentication |

#### Get a stockpile

```http
  GET /api/stockpiles/{stockpile_id}
```

| Notes               |
| :------------------------- |
| **Required**. Token authentication and stockpile {stockpile_id} parameter |

#### Create a stockpile

```http
  GET /api/stockpiles/create
```

| Notes               |
| :------------------------- |
| **Required**. Token authentication|

### Symbols

#### Get all symbols

```http
  GET /api/symbols
```

#### Get a symbol

```http
  GET /api/symbols/{stock_symbol}
```
| Notes               |
| :------------------------- |
| **Required**. Symbol {stock_symbol} parameter |

#### Update symbols

```http
  GET /api/symbols/{stock_symbol}
```

| Notes               |
| :------------------------- |
| **Required**. Symbol {stock_symbol} parameter |

### Stocks
#### Get all stocks

```http
  GET /api/stocks/
```

#### Get a stock

```http
  GET /api/stocks/{stock_symbol}
```
| Notes               |
| :------------------------- |
| **Required**. Stock {stock_symbol} parameter |

#### Update stocks

```http
  GET /api/stocks/update
```
May take a few minutes to run due to free tier AP limitations from AlphaVantage.  Ideally will be run daily using automation in the future using a paid tier. This command should be run on a daily basis. 

### User 
#### Get all users

```http
  GET /api/users
```

| Notes               |
| :------------------------- |
| **Required**. Token authentication |

#### Get a user

```http
  GET /api/stockpiles/user/{user_id}
```

| Notes               |
| :------------------------- |
| **Required**. Token authentication |

### Account creation and authentication
#### Login

```http
  GET /api/login
```

| Notes               |
| :------------------------- |
| Login a user |

#### Logout

```http
  GET /api/logout
```

| Notes               |
| :------------------------- |
| Logout a user |

#### Register

```http
  GET /api/register
```

| Notes               |
| :------------------------- |
| Register a new user |

### Tokens
#### Get a token

```http
  GET /api/token/
```

| Notes               |
| :------------------------- |
| **Required** User must be authenticated|

#### Refresh a token

```http
  GET /api/token/refresh
```

| Notes               |
| :------------------------- |
| **Required** User must be authenticated |



## Future Enhancements

Future goals for the application include:
- Replace / enhance token authentication (it seems fragile and a little buggy)
- Add data visualizations
- Add automation to update stocks data and symbols list on daily basis
- Add historical stockpile tracking data for analysis
- Pagination to help handle scalability
- Integrate Python requirements into the project as dependencies

## Related Github Repos

### Client side
https://github.com/mikalmorello/stockpile

### Server / API
https://github.com/mikalmorello/stockpile-api
## General CSCIE33a Project Notes

Overall the project went well, but I tried a lot of new technologies that I have never used before.  I was able to accomplish most of my goals, including designing and developing a standalone client App, using Django primarily as an API.  I believe the application is in a good spot for future enhancements and feature development.

### Challenges
I faced a few challenges during this project including:

#### Client Side Authentication 
What felt trivial using a Django only application, authentication, was the most difficult part of the project. In order to implement authentication, almost all of the tutorials I tried following pointed towards using the Django REST Frameworks.  I was hesitant to use it, since it's approach was quite a bit different than what we learned in class.  But eventially I rebuilt my Django app using the REST framework, so that I could use the JSON web token authentication.  Once the REST Framework was implemented, I had to rebuild the front-end application to use the tokens, add authentication to routes, and use (learn) useContext to make the user data /authentication available throughout the API calls.  This took much longer than I had expected, but it was critical to React to be able to handle users.  The refresh tokens are still a little buggy, and I hope to replace them with another approach in the future.

#### API Rate Limiting
AlphaVantage's free tier uses substantial rate limiting (5 calls per minute), which make it hard to scale the application currently.  Due to the restrictions, I had to rebiuld the data models, and tried several approaches for refreshing app data.  I eventually decided to create update endpoints that can be hit manually at first, but eventually run on a daily basis via automation.  To reduce API calls, I only store and call stocks that are or have been part of stockpiles.  Eventually, I would like to pay for the upgraded tier, and potentially pull all stock data in the future, as opposed to a subset.

#### Error Handling
I am still having issues figuring out how to handle error handling from the Django Rest Framework to React, especially if I have to modify the data in Django (ie not just a form submission).  It is something I struggled with, but the REST framework abstracted the concepts to where I need to learn more before I can understand how it is working using their serializer.


### Final Notes
I really enjoyed how intuitive Django is.  I felt that the combination of React and Django is very powerful, and it was nice to be able to manage all the logic for the endpoints using a back-end services, so that React could focus on rendering just the views.  I am really looking forward trying to deploy this app once a few enhancements are made. 
